# 快速开始

## 视频版

https://video-autolabor-1255388470.cos.ap-beijing.myqcloud.com/AutolaborPro1/%E5%AF%BC%E8%88%AA%E5%A5%97%E4%BB%B6%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B.mp4

## 文字版

#### 准备工作：
1. AP1室内导航套件
2. 一套无线键鼠


## 操作步骤

### 一、连接键鼠
鼠标键盘建议使用普通成套的无线键鼠，避免有线和无线混合使用。

### 二、启动系统
打开电源，打开工控机，等待Autolabor OS系统启动，输入密码autolabor，字母全部是小写，回车。

### 三、SLAM建图导航


#### 准备工作：
1. 将AP1控制模式切换到上位机控制，打开急停开关，确保急停开关没有被按下
2. 禁用工控机无线功能
  在建图过程中，如果工控机连接了无线网络，当AP1走出无线网络的覆盖区域后，网络连接会自动断开，这将导致AP1控制失控，所以在开始建图之前，为了避免失控，需要将工控机的无线网络连接关闭。

#### 1. 点击【开始建图】
RVIZ工具打开，能够看到地图中的一个黄色的小车，这是AP1在环境中的初始位置。

使用键盘的上下左右控制AP1行走，小车边走边建图，可以看到环境地图随着小车的行走不断被构建更新。

我们看到地图中，黑色是不可行走区域，白色是可行走区域，灰色是未知区域，红色是激光雷达实时数据。

注：

* ROS键盘控制功能在系统中已经安装好，无需安装可直接使用。
* 使用键盘上下左右控制车辆行走，数字键【1/2】线速度增加/减少，数字键【3/4】角速度增加/减少，数字键【9】启用，数字键【0】禁用。

在小车行走建图的时候，有临时移动障碍物的出现在小车附近，如走动的人，即便之后离开了，建图的结果上有可能会有黑色障碍物在对应的位置；有些障碍物也有可能没有被检测到，在地图中没有显示出来，那么想要导航的效果更好的话，可以手动修正地图，但这一步不是必须操作，可做可不做，不影响导航功能。

#### 2. 建图完毕，点击【保存并停止建图】

#### 3. 修正建图结果

注：此步非必须操作，可跳过至下一步。

建好的地图存放在下面的文件夹中

`/home/autolabor/catkin_ws/src/launch/autolabor_box_launch/map`


每一次建图的结果都会存放在这里，每次会生成对应的4个文件，real_map.pgm、real_map.yaml、show_map.pgm、show_map.yaml，后缀.pgm是图像文件，.yaml是对图像文件的解释文件，real_map是定位时使用的地图，show_map是导航时使用的地图。

请注意，在这里要修改的建图文件是show_map.pgm，其他的文件不做修改。

使用U盘将show_map.pgm拷贝至自己的电脑里，使用系统画图工具或者专业的绘图软件来修改地图。

注意：地图文件不能有任何的翻转、移动操作，只能进行涂抹操作。

拿到地图，对照真实的建图环境，将没有障碍物的地方使用白色涂抹掉，真实环境中存在障碍物，但建图结果上没有的，使用黑色增加。

哪些区域不希望小车去行走，也可以使用黑色来涂抹设置为不可行走范围的，比如环境中有椅子或者桌子等开放式区域，我们可以涂抹黑色进行封闭处理，将其变为墙。

最好也对地图边缘等未知区域进行封闭处理，使用黑色将边界涂抹。

处理完地图之后，将该文件拷贝回原文件夹中，可将之前的文件做一个备份，请注意将修改后的地图文件名称与之前保持一致。

#### 4. 点击【开始导航】

RVIZ工具打开，我们看到修改后的地图已经自动加载进来了。

在地图中初始化车的所在位置，并设定一个目标位置，小车就可以自动导航了。

初始化所在位置的设置方式有两种：

1. 使用键盘控制小车走到初始建图位置，注意车头、车尾方向与之前基本保持一致；

2. 使用2D Pose Estimate，点击 2D Pose Estimate（2D nav goal左边），根据小车现在的所在位置，对比地图，找到车辆在地图中大概的位置，根据真实车头的朝向，拉动鼠标，方向指向车头朝向的方向，这样车辆就完成了位置初始化。

初始化位置之后，我们可以使用键盘控制小车，小幅度的控制小车行走，看到小车周围的蓝色块收敛，程序会依据激光雷达的数据校准当前位置，这样我们给定的初始位置相对来说也就更精准一些。

接下来这一步请不要忘记，按【0】关闭键盘控制功能，控制方式将切换至导航程序控制。

点击2D Nav Goal，指定目标位置，拉动鼠标，箭头方向是最终车辆运行至目标的车头朝向，鼠标松开，这样就完成了目标点的指定。

#### 5. 点击【终止导航】，停止导航功能，导航结束。

之后在同一环境中需要再次使用导航功能时，无须重复建图，点击【开始导航】即可。
